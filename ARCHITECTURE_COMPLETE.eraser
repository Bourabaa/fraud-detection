---
title: Fraud Detection System - Architecture Compl√®te depuis IAM jusqu'au D√©ploiement
---

# Architecture Compl√®te - Pipeline de D√©ploiement

```mermaid
graph TB
    subgraph "PHASE 1: Setup AWS & IAM"
        IAM[üë§ Cr√©ation IAM User<br/>AWS Access Keys]
        IAMRole[üîê Cr√©ation IAM Role<br/>SageMaker Execution Role]
        IAM --> IAMRole
    end

    subgraph "PHASE 2: Pr√©paration ML (Notebook)"
        Notebook[üìì Jupyter Notebook<br/>credit_card_fraud_detection_fixed.ipynb]
        DataLoad[üìä Chargement Donn√©es<br/>creditcard.csv<br/>284,807 transactions]
        DataPrep[üîß Pr√©paration Donn√©es<br/>Balance dataset<br/>Train/Test split]
        Script[üìù Cr√©ation script.py<br/>RandomForest Classifier]
        S3Upload[‚òÅÔ∏è Upload vers S3<br/>train.csv + test.csv]
        
        Notebook --> DataLoad
        DataLoad --> DataPrep
        DataPrep --> Script
        Script --> S3Upload
    end

    subgraph "PHASE 3: Entra√Ænement SageMaker"
        Estimator[‚öôÔ∏è Configuration Estimator<br/>SKLearn Framework<br/>ml.c5.xlarge]
        Training[üèãÔ∏è Training Job<br/>RF-fraud-detection-*]
        ModelArtifact[üì¶ Model Artifact<br/>S3: model.tar.gz]
        
        S3Upload --> Estimator
        Estimator --> Training
        Training --> ModelArtifact
    end

    subgraph "PHASE 4: D√©ploiement Endpoint"
        SageMakerModel[ü§ñ SageMaker Model<br/>fraud-detection-model-*]
        Endpoint[üöÄ SageMaker Endpoint<br/>ml.t2.medium<br/>Pr√™t pour inference]
        
        ModelArtifact --> SageMakerModel
        SageMakerModel --> Endpoint
    end

    subgraph "PHASE 5: Backend API"
        BackendCode[üíª Code Backend<br/>Node.js/Express<br/>server.js]
        EBDeploy[üì§ D√©ploiement<br/>Elastic Beanstalk]
        BackendAPI[üåê Backend API<br/>/api/predict<br/>HTTP]
        
        BackendCode --> EBDeploy
        EBDeploy --> BackendAPI
    end

    subgraph "PHASE 6: Proxy HTTPS"
        LambdaCode[‚ö° Code Lambda<br/>Proxy Function]
        LambdaDeploy[üì§ D√©ploiement Lambda<br/>Function URL]
        LambdaURL[üîó Lambda Function URL<br/>HTTPS Proxy]
        
        LambdaCode --> LambdaDeploy
        LambdaDeploy --> LambdaURL
    end

    subgraph "PHASE 7: Frontend"
        ReactCode[‚öõÔ∏è Code React<br/>App.js + Tailwind]
        AmplifyDeploy[üì§ D√©ploiement<br/>AWS Amplify]
        Frontend[üåç Frontend Web<br/>HTTPS]
        
        ReactCode --> AmplifyDeploy
        AmplifyDeploy --> Frontend
    end

    subgraph "PHASE 8: Monitoring"
        CloudWatch[üìä CloudWatch<br/>M√©triques & Logs]
        Grafana[üìà Grafana Cloud<br/>Dashboards]
        
        BackendAPI --> CloudWatch
        LambdaURL --> CloudWatch
        CloudWatch --> Grafana
    end

    subgraph "FLUX DE PRODUCTION"
        User[üë§ Utilisateur]
        User -->|1. Saisie transaction| Frontend
        Frontend -->|2. POST /api/predict HTTPS| LambdaURL
        LambdaURL -->|3. Proxy HTTP| BackendAPI
        BackendAPI -->|4. invokeEndpoint| Endpoint
        Endpoint -->|5. Pr√©diction| Endpoint
        Endpoint -->|6. R√©sultat| BackendAPI
        BackendAPI -->|7. JSON Response| LambdaURL
        LambdaURL -->|8. HTTPS Response| Frontend
        Frontend -->|9. Affichage| User
    end

    IAMRole -.->|Permissions| Estimator
    IAMRole -.->|Permissions| SageMakerModel
    IAMRole -.->|Permissions| Endpoint
    BackendAPI -.->|IAM Credentials| Endpoint
```

## √âtapes D√©taill√©es du Pipeline

### PHASE 1: Setup AWS & IAM (Pr√©requis)

**1.1 Cr√©ation IAM User**
- Aller dans AWS Console ‚Üí IAM ‚Üí Users
- Cr√©er un nouvel utilisateur
- Attacher les politiques: `AmazonSageMakerFullAccess`, `AmazonS3FullAccess`
- G√©n√©rer Access Key ID et Secret Access Key
- ‚ö†Ô∏è Sauvegarder les credentials

**1.2 Cr√©ation IAM Role pour SageMaker**
- Aller dans IAM ‚Üí Roles ‚Üí Create Role
- Service: SageMaker
- Attacher politiques: `AmazonSageMakerFullAccess`, `AmazonS3FullAccess`
- Nom du r√¥le: `SageMaker-SageMaker-roleaccess`
- ARN: `arn:aws:iam::ACCOUNT_ID:role/service-role/SageMaker-SageMaker-roleaccess`

---

### PHASE 2: Pr√©paration ML (Notebook Jupyter)

**2.1 Setup et Imports** (Cell 1-2)
```python
import sagemaker
from sklearn.model_selection import train_test_split
import boto3
import pandas as pd
```

**2.2 Chargement Donn√©es** (Cell 3-5)
- Charger `creditcard.csv` (284,807 transactions)
- 31 colonnes: Time, V1-V28 (PCA), Amount, Class
- V√©rifier les donn√©es manquantes

**2.3 Analyse et Pr√©paration** (Cell 6-11)
- S√©parer transactions l√©gitimes (284,315) et frauduleuses (492)
- Cr√©er dataset √©quilibr√©: √©chantillonner 492 transactions l√©gitimes
- Dataset final: 984 transactions (492 fraud + 492 l√©gitime)

**2.4 Split Train/Test** (Cell 16-17)
- Features: 30 colonnes (Time, V1-V28, Amount)
- Label: derni√®re colonne (Class: 0 ou 1)
- Train: 787 transactions (70%)
- Test: 197 transactions (30%)
- Sauvegarder: `train.csv` et `test.csv` (sans header)

**2.5 Upload S3** (Cell 18)
```python
trainpath = sess.upload_data("train.csv", bucket=bucket, key_prefix=sk_prefix)
testpath = sess.upload_data("test.csv", bucket=bucket, key_prefix=sk_prefix)
```
- Bucket: `deployment-s3-bucket-sagemaker`
- Path: `s3://bucket/sagemaker/fraude_detection/sklearncontainer/`

**2.6 Cr√©ation script.py** (Cell 19)
- Script d'entra√Ænement RandomForest
- Fonction `model_fn()` pour charger le mod√®le
- Sauvegarder mod√®le avec `joblib.dump()`

---

### PHASE 3: Entra√Ænement SageMaker

**3.1 Configuration Estimator** (Cell 20)
```python
sklearn_estimator = SKLearn(
    entry_point="script.py",
    role=SAGEMAKER_ROLE,
    instance_type="ml.c5.xlarge",
    framework_version="0.23-1",
    hyperparameters={"n_estimators": 100}
)
```

**3.2 Lancement Training Job** (Cell 21)
```python
sklearn_estimator.fit({"train": trainpath, "test": testpath})
```
- Job name: `RF-fraud-detection-YYYY-MM-DD-HH-MM-SS`
- Dur√©e: ~73 secondes
- Instance: `ml.c5.xlarge`

**3.3 R√©cup√©ration Model Artifact** (Cell 22)
- Location: `s3://sagemaker-us-east-1-ACCOUNT_ID/RF-fraud-detection-*/output/model.tar.gz`
- Contient: `model.joblib` (mod√®le entra√Æn√©)

---

### PHASE 4: D√©ploiement Endpoint

**4.1 Cr√©ation SageMaker Model** (Cell 23)
```python
model = SKLearnModel(
    name="fraud-detection-model-YYYY-MM-DD-HH-MM-SS",
    model_data=artifact,
    role=SAGEMAKER_ROLE,
    entry_point="script.py",
    framework_version="0.23-1"
)
```

**4.2 D√©ploiement Endpoint** (Cell 24)
```python
predictor = model.deploy(
    initial_instance_count=1,
    instance_type="ml.t2.medium",
    endpoint_name=model_name
)
```
- Endpoint name: `fraud-detection-model-2025-11-11-13-30-24`
- Instance: `ml.t2.medium` (cost-effective)
- ‚ö†Ô∏è **Co√ªt**: Endpoint actif = facturation continue

**4.3 Test Endpoint** (Cell 25)
- Pr√©dictions sur 5 √©chantillons de test
- Accuracy globale: **92.39%**
- Confusion Matrix: 98 l√©gitimes, 84 fraudes d√©tect√©es

**4.4 ‚ö†Ô∏è IMPORTANT - Suppression Endpoint** (Cell 26)
```python
predictor.delete_endpoint()  # Pour arr√™ter les co√ªts
```

---

### PHASE 5: Backend API

**5.1 D√©veloppement Backend**
- Code: `fraud-detection-backend/server.js`
- Framework: Node.js + Express
- Endpoint: `POST /api/predict`
- Int√©gration: AWS SDK pour SageMaker Runtime

**5.2 D√©ploiement Elastic Beanstalk**
- Cr√©er application Elastic Beanstalk
- Platform: Node.js
- Upload: `backend.zip`
- Instance: `t2.micro` (Free Tier)
- URL: `http://frauddetection-env.eba-*.us-east-1.elasticbeanstalk.com`

**5.3 Configuration**
- Variables d'environnement:
  - `AWS_REGION`: `us-east-1`
  - `AWS_ACCESS_KEY_ID`: Credentials
  - `AWS_SECRET_ACCESS_KEY`: Credentials

---

### PHASE 6: Proxy HTTPS (Lambda)

**6.1 Cr√©ation Lambda Function**
- Code: `fraud-detection-backend/lambda-proxy/index-simple.js`
- Runtime: Node.js 20.x
- Fonction: Proxy HTTP ‚Üí HTTPS

**6.2 Configuration Function URL**
- Cr√©er Function URL
- Auth: NONE (public)
- CORS: Activ√©
- URL: `https://*.lambda-url.us-east-1.on.aws`

**6.3 Configuration**
- Variable: `BACKEND_BASE_URL` (URL Elastic Beanstalk)

---

### PHASE 7: Frontend React

**7.1 D√©veloppement Frontend**
- Code: `fraud-detection-ui/src/App.js`
- Framework: React 19 + Tailwind CSS
- Features:
  - Input manuel (30 features)
  - Upload CSV (traitement par lot)
  - Affichage r√©sultats avec confidence score

**7.2 D√©ploiement AWS Amplify**
- Connecter repository Git
- Root directory: `fraud-detection-ui`
- Build settings: `amplify.yml`
- Variable d'environnement: `REACT_APP_API_URL` (Lambda Function URL)

---

### PHASE 8: Monitoring

**8.1 CloudWatch Metrics**
- Backend envoie m√©triques:
  - `PredictionCount` (Fraud/Legitimate)
  - `ConfidenceScore`
  - `ResponseTime`
  - `ErrorCount`
- Lambda envoie logs automatiquement

**8.2 Grafana Cloud**
- Cr√©er compte Grafana Cloud (gratuit)
- Configurer CloudWatch comme data source
- Cr√©er dashboards:
  - Prediction Analytics
  - Lambda Performance
  - System Health

---

## Flux de Production Complet

### Requ√™te (Request)
1. **Utilisateur** ‚Üí Saisit transaction (30 features) dans React UI
2. **React UI** ‚Üí POST HTTPS ‚Üí Lambda Function URL
3. **Lambda Function URL** ‚Üí Route vers Lambda Function
4. **Lambda Function** ‚Üí Proxy HTTP ‚Üí Backend API
5. **Backend API** ‚Üí `invokeEndpoint()` ‚Üí SageMaker Endpoint
6. **SageMaker Endpoint** ‚Üí Ex√©cute ML Model
7. **ML Model** ‚Üí Retourne pr√©diction (0 ou 1)

### R√©ponse (Response)
8. **ML Model** ‚Üí Pr√©diction ‚Üí SageMaker Endpoint
9. **SageMaker Endpoint** ‚Üí R√©sultat ‚Üí Backend API
10. **Backend API** ‚Üí Log m√©triques ‚Üí CloudWatch
11. **Backend API** ‚Üí JSON response ‚Üí Lambda Function
12. **Lambda Function** ‚Üí Log ‚Üí CloudWatch
13. **Lambda Function** ‚Üí Response ‚Üí Lambda URL
14. **Lambda URL** ‚Üí HTTPS response ‚Üí React UI
15. **React UI** ‚Üí Affiche r√©sultat ‚Üí Utilisateur

### Monitoring (Temps R√©el)
16. **Backend & Lambda** ‚Üí M√©triques ‚Üí CloudWatch
17. **Grafana Cloud** ‚Üí Lit m√©triques ‚Üí CloudWatch
18. **Dashboards** ‚Üí Visualisation temps r√©el

---

## R√©sum√© des √âtapes

| Phase | Service | Action | R√©sultat |
|-------|---------|--------|----------|
| 1 | IAM | Cr√©er User + Role | Credentials AWS |
| 2 | Notebook | Pr√©parer donn√©es | train.csv, test.csv |
| 3 | SageMaker | Training Job | Model Artifact (S3) |
| 4 | SageMaker | Deploy Endpoint | Endpoint actif |
| 5 | Elastic Beanstalk | Deploy Backend | API HTTP |
| 6 | Lambda | Deploy Proxy | Function URL HTTPS |
| 7 | Amplify | Deploy Frontend | Site web HTTPS |
| 8 | CloudWatch/Grafana | Config Monitoring | Dashboards |

---

## Co√ªts Estim√©s (Free Tier)

- ‚úÖ **IAM**: Gratuit
- ‚úÖ **S3**: Gratuit (5GB)
- ‚ö†Ô∏è **SageMaker Training**: ~$0.50 (ml.c5.xlarge, 73s)
- ‚ö†Ô∏è **SageMaker Endpoint**: ~$0.05/heure (ml.t2.medium) - **Supprimer apr√®s test!**
- ‚úÖ **Elastic Beanstalk**: Gratuit (t2.micro, 750h/mois)
- ‚úÖ **Lambda**: Gratuit (1M requ√™tes/mois)
- ‚úÖ **Amplify**: Gratuit (1000 builds/mois)
- ‚úÖ **CloudWatch**: Gratuit (10 m√©triques, 5GB logs)
- ‚úÖ **Grafana Cloud**: Gratuit (10GB logs, 10k m√©triques)

**Total estim√©**: ~$0.50 + co√ªt endpoint (supprimer apr√®s test!)

---

## Checklist de D√©ploiement

### Phase ML (Notebook)
- [ ] Cr√©er IAM User avec credentials
- [ ] Cr√©er IAM Role pour SageMaker
- [ ] Ex√©cuter toutes les cellules du notebook
- [ ] V√©rifier endpoint d√©ploy√©
- [ ] Tester endpoint avec pr√©dictions
- [ ] ‚ö†Ô∏è **Supprimer endpoint apr√®s test** (co√ªts!)

### Phase Backend
- [ ] D√©velopper `server.js` avec int√©gration SageMaker
- [ ] Cr√©er `package.json` avec d√©pendances
- [ ] Cr√©er `backend.zip`
- [ ] D√©ployer sur Elastic Beanstalk
- [ ] Configurer variables d'environnement
- [ ] Tester API avec curl/PowerShell

### Phase Proxy
- [ ] Cr√©er Lambda Function
- [ ] Upload code proxy
- [ ] Cr√©er Function URL
- [ ] Configurer CORS
- [ ] Tester proxy avec backend

### Phase Frontend
- [ ] D√©velopper React UI
- [ ] Configurer `amplify.yml`
- [ ] Connecter repository Git
- [ ] D√©ployer sur Amplify
- [ ] Configurer `REACT_APP_API_URL`
- [ ] Tester interface compl√®te

### Phase Monitoring
- [ ] V√©rifier m√©triques CloudWatch
- [ ] Cr√©er compte Grafana Cloud
- [ ] Configurer CloudWatch data source
- [ ] Cr√©er dashboards
- [ ] Configurer alertes

---

## Technologies Utilis√©es

- **ML**: Scikit-learn, RandomForest, SageMaker
- **Backend**: Node.js, Express, AWS SDK v2
- **Proxy**: AWS Lambda (Node.js 20.x)
- **Frontend**: React 19, Tailwind CSS
- **Hosting**: AWS Amplify, Elastic Beanstalk
- **Monitoring**: CloudWatch, Grafana Cloud
- **Storage**: Amazon S3

---

## Points d'Attention

‚ö†Ô∏è **Co√ªts SageMaker Endpoint**: L'endpoint facture tant qu'il est actif. Supprimer apr√®s les tests!

‚ö†Ô∏è **IAM Permissions**: S'assurer que le r√¥le SageMaker a les bonnes permissions.

‚ö†Ô∏è **HTTPS**: Le frontend (HTTPS) ne peut pas appeler le backend (HTTP) directement. Utiliser Lambda Function URL comme proxy.

‚ö†Ô∏è **CORS**: Configurer CORS dans Lambda et Backend pour permettre les requ√™tes cross-origin.

‚úÖ **Free Tier**: La plupart des services sont dans le Free Tier AWS.

